emi-voms-mysql clean deployment test
EMI repo URL: http://eticssoft.web.cern.ch/eticssoft/mock/emi-3-rc-sl5.repo
VOMS repo URL: http://radiohead.cnaf.infn.it:9999/view/REPOS/job/repo_voms_SL5/lastSuccessfulBuild/artifact/voms.repo
[root@superchunk.cnaf.infn.it ~]# wget -q http://eticssoft.web.cern.ch/eticssoft/mock/emi-3-rc-sl5.repo -O /etc/yum.repos.d/test_emi.repo
[root@superchunk.cnaf.infn.it ~]# wget -q http://radiohead.cnaf.infn.it:9999/view/REPOS/job/repo_voms_SL5/lastSuccessfulBuild/artifact/voms.repo -O /etc/yum.repos.d/test_voms.repo
[root@superchunk.cnaf.infn.it ~]# echo >> /etc/yum.repos.d/test_voms.repo; echo 'priority=1' >> /etc/yum.repos.d/test_voms.repo
[root@superchunk.cnaf.infn.it ~]# yum clean all
Loaded plugins: kernel-module
Repository EGI-trustanchors is listed more than once in the configuration
Cleaning up Everything
[root@superchunk.cnaf.infn.it ~]# yum -y install emi-release
Loaded plugins: kernel-module
Repository EGI-trustanchors is listed more than once in the configuration
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package emi-release.noarch 0:3.0.0-1.el5 set to be updated
--> Processing Dependency: yum-protectbase for package: emi-release
--> Processing Dependency: yum-priorities for package: emi-release
--> Running transaction check
---> Package yum-priorities.noarch 0:1.1.16-21.el5 set to be updated
---> Package yum-protectbase.noarch 0:1.1.16-21.el5 set to be updated
--> Finished Dependency Resolution
Beginning Kernel Module Plugin
Finished Kernel Module Plugin

Dependencies Resolved

================================================================================
 Package             Arch       Version            Repository              Size
================================================================================
Installing:
 emi-release         noarch     3.0.0-1.el5        EMI-3-testing-base     4.7 k
Installing for dependencies:
 yum-priorities      noarch     1.1.16-21.el5      core                    16 k
 yum-protectbase     noarch     1.1.16-21.el5      core                    14 k

Transaction Summary
================================================================================
Install       3 Package(s)
Upgrade       0 Package(s)

Total download size: 34 k
Downloading Packages:
--------------------------------------------------------------------------------
Total                                           185 kB/s |  34 kB     00:00     
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : yum-protectbase                                          1/3 
  Installing     : yum-priorities                                           2/3 
  Installing     : emi-release                                              3/3 

Installed:
  emi-release.noarch 0:3.0.0-1.el5                                              

Dependency Installed:
  yum-priorities.noarch 0:1.1.16-21.el5  yum-protectbase.noarch 0:1.1.16-21.el5 

Complete!
[root@superchunk.cnaf.infn.it ~]# yum -y install emi-voms-oracle
Loaded plugins: kernel-module, priorities, protectbase
Repository EGI-trustanchors is listed more than once in the configuration
4469 packages excluded due to repository priority protections
0 packages excluded due to repository protections
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package emi-voms-oracle.noarch 0:1.1.0-1.el5 set to be updated
--> Processing Dependency: voms-admin-server for package: emi-voms-oracle
--> Processing Dependency: voms-oracle-plugin for package: emi-voms-oracle
--> Processing Dependency: fetch-crl for package: emi-voms-oracle
--> Processing Dependency: bdii for package: emi-voms-oracle
--> Processing Dependency: voms-server for package: emi-voms-oracle
--> Processing Dependency: glite-info-provider-service for package: emi-voms-oracle
--> Processing Dependency: voms-admin-client for package: emi-voms-oracle
--> Running transaction check
---> Package bdii.noarch 0:5.2.17-1.el5 set to be updated
--> Processing Dependency: glue-schema >= 2.0.0 for package: bdii
--> Processing Dependency: openldap2.4-servers for package: bdii
--> Processing Dependency: openldap-clients for package: bdii
--> Processing Dependency: openldap-servers for package: bdii
--> Processing Dependency: expect for package: bdii
--> Processing Dependency: openldap2.4-clients for package: bdii
---> Package fetch-crl.noarch 0:2.8.5-1.el5 set to be updated
---> Package glite-info-provider-service.noarch 0:1.12.0-1.el5 set to be updated
---> Package voms-admin-client.noarch 0:2.0.18-1 set to be updated
--> Processing Dependency: python-ZSI for package: voms-admin-client
--> Processing Dependency: PyXML for package: voms-admin-client
--> Processing Dependency: python-simplejson for package: voms-admin-client
---> Package voms-admin-server.noarch 0:3.1.0-1 set to be updated
--> Processing Dependency: python(abi) = 2.6 for package: voms-admin-server
--> Processing Dependency: java-1.6.0-openjdk-devel for package: voms-admin-server
---> Package voms-oracle-plugin.x86_64 0:3.1.15-2 set to be updated
---> Package voms-server.x86_64 0:2.0.10-1 set to be updated
--> Processing Dependency: voms = 2.0.10-1 for package: voms-server
--> Processing Dependency: libvomsapi.so.1()(64bit) for package: voms-server
--> Running transaction check
---> Package PyXML.x86_64 0:0.8.4-4.el5_4.2 set to be updated
---> Package expect.x86_64 0:5.43.0-5.1 set to be updated
---> Package glue-schema.noarch 0:2.0.10-1.el5 set to be updated
---> Package java-1.6.0-openjdk-devel.x86_64 1:1.6.0.0-1.36.1.11.9.el5_9 set to be updated
--> Processing Dependency: java-1.6.0-openjdk = 1:1.6.0.0-1.36.1.11.9.el5_9 for package: java-1.6.0-openjdk-devel
--> Processing Dependency: libjli.so(SUNWprivate_1.1)(64bit) for package: java-1.6.0-openjdk-devel
--> Processing Dependency: libjli.so()(64bit) for package: java-1.6.0-openjdk-devel
---> Package openldap-clients.x86_64 0:2.3.43-12.el5_6.7 set to be updated
---> Package openldap-servers.x86_64 0:2.3.43-12.el5_6.7 set to be updated
--> Processing Dependency: libltdl.so.3()(64bit) for package: openldap-servers
---> Package openldap2.4-clients.x86_64 0:2.4.22-1.el5 set to be updated
--> Processing Dependency: lib64ldap2.4_2 = 2.4.22-1.el5 for package: openldap2.4-clients
--> Processing Dependency: liblber-2.4.so.2()(64bit) for package: openldap2.4-clients
--> Processing Dependency: libldap-2.4.so.2()(64bit) for package: openldap2.4-clients
---> Package openldap2.4-servers.x86_64 0:2.4.22-1.el5 set to be updated
--> Processing Dependency: openldap2.4-extra-schemas >= 1.3-7 for package: openldap2.4-servers
--> Processing Dependency: openldap2.4-extra-schemas >= 1.3-7 for package: openldap2.4-servers
--> Processing Dependency: libodbc.so.1()(64bit) for package: openldap2.4-servers
---> Package python-ZSI.noarch 0:2.0-7.el5 set to be updated
---> Package python-simplejson.x86_64 0:2.0.9-8.el5 set to be updated
---> Package python26.x86_64 0:2.6.8-2.el5 set to be updated
--> Processing Dependency: libpython2.6.so.1.0()(64bit) for package: python26
--> Processing Dependency: libffi.so.5()(64bit) for package: python26
---> Package voms.x86_64 0:2.0.10-1 set to be updated
--> Running transaction check
---> Package java-1.6.0-openjdk.x86_64 1:1.6.0.0-1.36.1.11.9.el5_9 set to be updated
--> Processing Dependency: tzdata-java for package: java-1.6.0-openjdk
--> Processing Dependency: libgif.so.4()(64bit) for package: java-1.6.0-openjdk
---> Package lib64ldap2.4_2.x86_64 0:2.4.22-1.el5 set to be updated
--> Processing Dependency: openldap2.4 >= 2.1.25-4mdk for package: lib64ldap2.4_2
---> Package libffi.x86_64 0:3.0.5-1.el5 set to be updated
---> Package libtool-ltdl.x86_64 0:1.5.22-7.el5_4 set to be updated
---> Package openldap2.4-extra-schemas.noarch 0:1.3-10.el5 set to be updated
---> Package python26-libs.x86_64 0:2.6.8-2.el5 set to be updated
---> Package unixODBC.x86_64 0:2.2.11-7.1 set to be updated
--> Running transaction check
---> Package giflib.x86_64 0:4.1.3-7.1.el5_3.1 set to be updated
---> Package openldap2.4.x86_64 0:2.4.22-1.el5 set to be updated
---> Package tzdata-java.x86_64 0:2013b-1.el5 set to be updated
--> Finished Dependency Resolution
Beginning Kernel Module Plugin
Finished Kernel Module Plugin

Dependencies Resolved

================================================================================
 Package             Arch   Version             Repository                 Size
================================================================================
Installing:
 emi-voms-oracle     noarch 1.1.0-1.el5         EMI-3-base                2.4 k
Installing for dependencies:
 PyXML               x86_64 0.8.4-4.el5_4.2     sl-base                   1.0 M
 bdii                noarch 5.2.17-1.el5        EMI-3-base                 23 k
 expect              x86_64 5.43.0-5.1          sl-base                   160 k
 fetch-crl           noarch 2.8.5-1.el5         epel                       24 k
 giflib              x86_64 4.1.3-7.1.el5_3.1   sl-base                    39 k
 glite-info-provider-service
                     noarch 1.12.0-1.el5        EMI-3-base                 67 k
 glue-schema         noarch 2.0.10-1.el5        EMI-3-base                 34 k
 java-1.6.0-openjdk  x86_64 1:1.6.0.0-1.36.1.11.9.el5_9
                                                sl-security                36 M
 java-1.6.0-openjdk-devel
                     x86_64 1:1.6.0.0-1.36.1.11.9.el5_9
                                                sl-security                12 M
 lib64ldap2.4_2      x86_64 2.4.22-1.el5        EMI-3-testing-third-party 300 k
 libffi              x86_64 3.0.5-1.el5         epel                       24 k
 libtool-ltdl        x86_64 1.5.22-7.el5_4      sl-base                    38 k
 openldap-clients    x86_64 2.3.43-12.el5_6.7   sl-security               223 k
 openldap-servers    x86_64 2.3.43-12.el5_6.7   sl-security               2.2 M
 openldap2.4         x86_64 2.4.22-1.el5        EMI-3-testing-third-party  40 k
 openldap2.4-clients x86_64 2.4.22-1.el5        EMI-3-testing-third-party 298 k
 openldap2.4-extra-schemas
                     noarch 1.3-10.el5          EMI-3-testing-third-party  46 k
 openldap2.4-servers x86_64 2.4.22-1.el5        EMI-3-testing-third-party 2.1 M
 python-ZSI          noarch 2.0-7.el5           epel                      574 k
 python-simplejson   x86_64 2.0.9-8.el5         EMI-3-third-party         141 k
 python26            x86_64 2.6.8-2.el5         epel                      6.5 M
 python26-libs       x86_64 2.6.8-2.el5         epel                      695 k
 tzdata-java         x86_64 2013b-1.el5         sl-security               184 k
 unixODBC            x86_64 2.2.11-7.1          sl-base                   834 k
 voms                x86_64 2.0.10-1            VOMS                      164 k
 voms-admin-client   noarch 2.0.18-1            VOMS                       93 k
 voms-admin-server   noarch 3.1.0-1             VOMS                       57 M
 voms-oracle-plugin  x86_64 3.1.15-2            VOMS                       56 k
 voms-server         x86_64 2.0.10-1            VOMS                      198 k

Transaction Summary
================================================================================
Install      30 Package(s)
Upgrade       0 Package(s)

Total download size: 122 M
Downloading Packages:
--------------------------------------------------------------------------------
Total                                           2.0 MB/s | 122 MB     01:00     
warning: rpmts_HdrFromFdno: Header V3 DSA signature: NOKEY, key ID df9e12ef
Importing GPG key 0xDF9E12EF "Doina Cristina Aiftimiei (EMI Release Manager) <aiftim@pd.infn.it>" from /etc/pki/rpm-gpg/RPM-GPG-KEY-emi
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : PyXML                                                   1/30 
  Installing     : libtool-ltdl                                            2/30 
  Installing     : openldap-servers                                        3/30 
  Installing     : openldap-clients                                        4/30 
  Installing     : expect                                                  5/30 
  Installing     : giflib                                                  6/30 
  Installing     : unixODBC                                                7/30 
  Installing     : voms                                                    8/30 
  Installing     : voms-server                                             9/30 
  Installing     : libffi                                                 10/30 
  Installing     : python-simplejson                                      11/30 
  Installing     : voms-oracle-plugin                                     12/30 
  Installing     : python-ZSI                                             13/30 
  Installing     : voms-admin-client                                      14/30 
  Installing     : glite-info-provider-service                            15/30 
  Installing     : fetch-crl                                              16/30 
  Installing     : glue-schema                                            17/30 
  Installing     : tzdata-java                                            18/30 
  Installing     : java-1.6.0-openjdk                                     19/30 
  Installing     : java-1.6.0-openjdk-devel                               20/30 
  Installing     : lib64ldap2.4_2                                         21/30 
  Installing     : python26                                               22/30 
  Installing     : python26-libs                                          23/30 
  Installing     : voms-admin-server                                      24/30 
  Installing     : openldap2.4-clients                                    25/30 
  Installing     : openldap2.4                                            26/30 
  Installing     : openldap2.4-extra-schemas                              27/30useradd: user ldap exists
Adding user ldap to group ldap
 
  Installing     : openldap2.4-servers                                    28/30Generating self-signed certificate...
To generate a self-signed certificate, you can use the utility
/usr/share/openldap2.4/gencert.sh...
 
  Installing     : bdii                                                   29/30 
  Installing     : emi-voms-oracle                                        30/30 

Installed:
  emi-voms-oracle.noarch 0:1.1.0-1.el5                                          

Dependency Installed:
  PyXML.x86_64 0:0.8.4-4.el5_4.2                                                
  bdii.noarch 0:5.2.17-1.el5                                                    
  expect.x86_64 0:5.43.0-5.1                                                    
  fetch-crl.noarch 0:2.8.5-1.el5                                                
  giflib.x86_64 0:4.1.3-7.1.el5_3.1                                             
  glite-info-provider-service.noarch 0:1.12.0-1.el5                             
  glue-schema.noarch 0:2.0.10-1.el5                                             
  java-1.6.0-openjdk.x86_64 1:1.6.0.0-1.36.1.11.9.el5_9                         
  java-1.6.0-openjdk-devel.x86_64 1:1.6.0.0-1.36.1.11.9.el5_9                   
  lib64ldap2.4_2.x86_64 0:2.4.22-1.el5                                          
  libffi.x86_64 0:3.0.5-1.el5                                                   
  libtool-ltdl.x86_64 0:1.5.22-7.el5_4                                          
  openldap-clients.x86_64 0:2.3.43-12.el5_6.7                                   
  openldap-servers.x86_64 0:2.3.43-12.el5_6.7                                   
  openldap2.4.x86_64 0:2.4.22-1.el5                                             
  openldap2.4-clients.x86_64 0:2.4.22-1.el5                                     
  openldap2.4-extra-schemas.noarch 0:1.3-10.el5                                 
  openldap2.4-servers.x86_64 0:2.4.22-1.el5                                     
  python-ZSI.noarch 0:2.0-7.el5                                                 
  python-simplejson.x86_64 0:2.0.9-8.el5                                        
  python26.x86_64 0:2.6.8-2.el5                                                 
  python26-libs.x86_64 0:2.6.8-2.el5                                            
  tzdata-java.x86_64 0:2013b-1.el5                                              
  unixODBC.x86_64 0:2.2.11-7.1                                                  
  voms.x86_64 0:2.0.10-1                                                        
  voms-admin-client.noarch 0:2.0.18-1                                           
  voms-admin-server.noarch 0:3.1.0-1                                            
  voms-oracle-plugin.x86_64 0:3.1.15-2                                          
  voms-server.x86_64 0:2.0.10-1                                                 

Complete!
[root@superchunk.cnaf.infn.it ~]# yum -y install oracle-instantclient-basic
Loaded plugins: kernel-module, priorities, protectbase
Repository EGI-trustanchors is listed more than once in the configuration
4469 packages excluded due to repository priority protections
0 packages excluded due to repository protections
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package oracle-instantclient-basic.x86_64 0:11.2.0.3.0-5.slc5 set to be updated
--> Finished Dependency Resolution
Beginning Kernel Module Plugin
Finished Kernel Module Plugin

Dependencies Resolved

================================================================================
 Package                      Arch     Version                Repository   Size
================================================================================
Installing:
 oracle-instantclient-basic   x86_64   11.2.0.3.0-5.slc5      Oracle-11    57 M

Transaction Summary
================================================================================
Install       1 Package(s)
Upgrade       0 Package(s)

Total download size: 57 M
Downloading Packages:
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : oracle-instantclient-basic                               1/1 

Installed:
  oracle-instantclient-basic.x86_64 0:11.2.0.3.0-5.slc5                         

Complete!
[root@superchunk.cnaf.infn.it ~]# cp tnsnames.ora /etc/voms
[root@superchunk.cnaf.infn.it ~]# mkdir -p /usr/lib64/oracle/11.2.0.3.0/client/lib64/log/diag/clients
[root@superchunk.cnaf.infn.it ~]# chmod 777 /usr/lib64/oracle/11.2.0.3.0/client/lib64/log/diag/clients
[root@superchunk.cnaf.infn.it ~]# voms-configure install --vo emi3     --core-port 15000     --hostname superchunk.cnaf.infn.it     --dbtype oracle     --dbname voms     --deploy-database     --dbusername admin_25     --dbpassword pwd     --mail-from andrea.ceccanti@cnaf.infn.it     --smtp-host postino.cnaf.infn.it
Configuring VOMS admin service for vo emi3
Creating VOMS services certificate in /etc/grid-security/vomscert.pem, /etc/grid-security/vomskey.pem
Deploying database for VO emi3
Checking database connectivity...
Database contacted succesfully
Checking database existence...
No voms-admin database found.
Checking that the database is writable...
Database is writable.
create table acl2 (acl_id number(19,0) not null, group_id number(19,0) not null, defaultACL number(1,0) not null, role_id number(19,0), primary key (acl_id), unique (group_id, defaultACL, role_id))
create table acl2_permissions (acl_id number(19,0) not null, permissions number(10,0), admin_id number(19,0) not null, primary key (acl_id, admin_id))
create table admins (adminid number(19,0) not null, dn varchar2(255 char) not null, email_address varchar2(255 char), ca number(5,0) not null, primary key (adminid), unique (dn, ca))
create table attributes (a_id number(19,0) not null, a_name varchar2(255 char) not null unique, a_desc clob, a_uniq number(1,0) default 0, primary key (a_id))
create table aup (id number(19,0) not null, name varchar2(255 char) not null unique, description varchar2(255 char), reacceptancePeriod number(10,0) not null, primary key (id))
create table aup_acc_record (id number(19,0) not null, aup_version_id number(19,0) not null, usr_id number(19,0) not null, last_acceptance_date timestamp not null, valid number(1,0), primary key (id), unique (aup_version_id, usr_id))
create table aup_version (id number(19,0) not null, aup_id number(19,0) not null, version varchar2(255 char) not null, url varchar2(255 char), text varchar2(255 char), creationTime timestamp not null, lastForcedReacceptanceTime timestamp, active number(1,0) not null, primary key (id), unique (aup_id, version))
create table ca (cid number(5,0) not null, subject_string varchar2(255 char) not null unique, description varchar2(255 char), creation_time timestamp not null, primary key (cid))
create table capabilities (cid number(19,0) not null, capability varchar2(255 char) not null, primary key (cid))
create table certificate (id number(19,0) not null, creation_time timestamp not null, subject_string varchar2(255 char) not null, suspended number(1,0) not null, suspended_reason varchar2(255 char), suspension_reason_code varchar2(255 char), ca_id number(5,0) not null, usr_id number(19,0) not null, primary key (id), unique (ca_id, subject_string))
create table certificate_request (certificate raw(255), certificateIssuer varchar2(255 char) not null, certificateSubject varchar2(255 char) not null, request_id number(19,0) not null, primary key (request_id))
create table group_attrs (a_id number(19,0) not null, g_id number(19,0) not null, a_value varchar2(255 char), primary key (a_id, g_id))
create table group_membership_req (groupName varchar2(255 char) not null, request_id number(19,0) not null, primary key (request_id))
create table groups (gid number(19,0) not null, dn varchar2(255 char) not null unique, description varchar2(255 char), parent number(19,0), must number(1,0) not null, restricted number(1,0), primary key (gid))
create table m (mapping_id number(19,0) not null, userid number(19,0) not null, gid number(19,0) not null, rid number(19,0), cid number(19,0), primary key (mapping_id), unique (userid, gid, rid))
create table memb_req (id number(19,0) not null, creation_date timestamp not null, evaluation_date timestamp, status number(10,0) not null, confirm_id varchar2(255 char) not null, dn varchar2(255 char) not null, ca varchar2(255 char) not null, cn varchar2(255 char), mail varchar2(255 char) not null, primary key (id))
create table membership_rem_req (reason varchar2(255 char) not null, request_id number(19,0) not null, primary key (request_id))
create table personal_info (id number(19,0) not null, value varchar2(255 char), visible number(1,0), personal_info_type_id number(19,0) not null, primary key (id))
create table personal_info_type (id number(19,0) not null, description varchar2(255 char), type varchar2(255 char) not null unique, primary key (id))
create table req (request_id number(19,0) not null, completionDate timestamp, creationDate timestamp, expirationDate timestamp, status varchar2(255 char) not null, requester_info_id number(19,0) not null, primary key (request_id), unique (requester_info_id))
create table requester_info (id number(19,0) not null, address varchar2(255 char), certificateIssuer varchar2(255 char) not null, certificateSubject varchar2(255 char) not null, emailAddress varchar2(255 char) not null, institution varchar2(255 char), name varchar2(255 char), phoneNumber varchar2(255 char), surname varchar2(255 char), voMember number(1,0), primary key (id))
create table requester_personal_info (requester_id number(19,0) not null, pi_value varchar2(255 char), pi_key varchar2(255 char), primary key (requester_id, pi_key))
create table role_attrs (a_id number(19,0) not null, g_id number(19,0) not null, r_id number(19,0) not null, a_value varchar2(255 char), primary key (a_id, g_id, r_id))
create table role_membership_req (groupName varchar2(255 char), roleName varchar2(255 char), request_id number(19,0) not null, primary key (request_id))
create table roles (rid number(19,0) not null, role varchar2(255 char) not null unique, primary key (rid))
create table seqnumber (seq varchar2(255 char) not null, primary key (seq))
create table sign_aup_task (task_id number(19,0) not null, aup_id number(19,0) not null, primary key (task_id))
create table tag_mapping (mapping_id number(19,0) not null, tag_id number(19,0) not null, gid number(19,0) not null, rid number(19,0), admin_id number(19,0) not null, primary key (mapping_id), unique (tag_id, gid, rid, admin_id))
create table tags (id number(19,0) not null, name varchar2(255 char) not null unique, implicit number(1,0) not null, permissions number(10,0) not null, permissionsOnPath number(10,0), primary key (id))
create table task (task_id number(19,0) not null, completionDate timestamp, creationDate timestamp, expiryDate timestamp, status varchar2(255 char) not null, admin_id number(19,0), task_type_id number(19,0) not null, usr_id number(19,0), primary key (task_id))
create table task_log_record (id number(19,0) not null, adminDn varchar2(255 char), creation_time timestamp not null, event varchar2(255 char) not null, userDn varchar2(255 char), task_id number(19,0) not null, primary key (id))
create table task_type (id number(19,0) not null, description varchar2(255 char), name varchar2(255 char) not null unique, primary key (id))
create table user_request_task (task_id number(19,0) not null, req_id number(19,0) not null, primary key (task_id))
create table usr (userid number(19,0) not null, address varchar2(255 char), creation_time timestamp not null, dn varchar2(255 char), email_address varchar2(255 char) not null, end_time timestamp not null, institution varchar2(255 char), name varchar2(255 char), phone_number varchar2(255 char), surname varchar2(255 char), suspended number(1,0), suspension_reason varchar2(255 char), suspension_reason_code varchar2(255 char), ca number(5,0), primary key (userid))
create table usr_attrs (a_id number(19,0) not null, u_id number(19,0) not null, a_value varchar2(255 char), primary key (a_id, u_id))
create table version (version number(10,0) not null, admin_version varchar2(255 char), primary key (version))
create table vo_membership_req (confirmId varchar2(255 char) not null, request_id number(19,0) not null, primary key (request_id))
alter table acl2 add constraint FK2D98E8720C9B10 foreign key (role_id) references roles on delete cascade
alter table acl2 add constraint FK2D98E8FCFA8B04 foreign key (group_id) references groups on delete cascade
alter table acl2_permissions add constraint FK35C6CFADD91CE8A3 foreign key (acl_id) references acl2
alter table acl2_permissions add constraint FK35C6CFADA4AD9904 foreign key (admin_id) references admins
alter table admins add constraint FKAB3A67047C6FEB32 foreign key (ca) references ca
alter table aup_acc_record add constraint FKB1979B32EE2D4487 foreign key (usr_id) references usr
alter table aup_acc_record add constraint FKB1979B32815F1678 foreign key (aup_version_id) references aup_version
alter table aup_version add constraint fk_aup_version_aup foreign key (aup_id) references aup on delete cascade
alter table certificate add constraint FK745F4197EE2D4487 foreign key (usr_id) references usr
alter table certificate add constraint FK745F419782107F70 foreign key (ca_id) references ca
alter table certificate_request add constraint FK47CA53E7D75D60A4 foreign key (request_id) references req
alter table group_attrs add constraint FK40B1A2E2566C2A8F foreign key (a_id) references attributes
alter table group_attrs add constraint FK40B1A2E2DEFC581C foreign key (g_id) references groups on delete cascade
alter table group_membership_req add constraint FKBD145E75D75D60A4 foreign key (request_id) references req
alter table groups add constraint FKB63DD9D4A3771CD3 foreign key (parent) references groups
alter table m add constraint fk_m_roles foreign key (rid) references roles on delete cascade
alter table m add constraint fk_m_groups foreign key (gid) references groups on delete cascade
alter table m add constraint fk_m_cap foreign key (cid) references capabilities
alter table m add constraint fk_m_usr foreign key (userid) references usr
alter table membership_rem_req add constraint FK1877BC10D75D60A4 foreign key (request_id) references req
alter table personal_info add constraint FK229FDF4DA8D3C6BC foreign key (personal_info_type_id) references personal_info_type
alter table req add constraint FK1B89EC37E889D foreign key (requester_info_id) references requester_info
alter table requester_personal_info add constraint FK7E3D7FCAD500B8D2 foreign key (requester_id) references requester_info
alter table role_attrs add constraint FK6BDE9799566C2A8F foreign key (a_id) references attributes
alter table role_attrs add constraint FK6BDE979920304994 foreign key (r_id) references roles on delete cascade
alter table role_attrs add constraint FK6BDE9799DEFC581C foreign key (g_id) references groups
alter table role_membership_req add constraint FK3B9C79ED75D60A4 foreign key (request_id) references req
alter table sign_aup_task add constraint FK7FCB416A32B8C70C foreign key (task_id) references task
alter table sign_aup_task add constraint FK7FCB416ADA1C6363 foreign key (aup_id) references aup
alter table tag_mapping add constraint fk_tag_mapping_roles foreign key (rid) references roles on delete cascade
alter table tag_mapping add constraint fk_tag_mapping_admins foreign key (admin_id) references admins on delete cascade
alter table tag_mapping add constraint fk_tag_mapping_groups foreign key (gid) references groups on delete cascade
alter table tag_mapping add constraint fk_tag_mapping_tag foreign key (tag_id) references tags on delete cascade
alter table task add constraint FK3635859AD54C57 foreign key (task_type_id) references task_type
alter table task add constraint FK363585EE2D4487 foreign key (usr_id) references usr
alter table task add constraint FK363585A4AD9904 foreign key (admin_id) references admins
alter table task_log_record add constraint FK77673CA632B8C70C foreign key (task_id) references task
alter table user_request_task add constraint FKACB7D2932B8C70C foreign key (task_id) references task
alter table user_request_task add constraint FKACB7D299D73AC35 foreign key (req_id) references req
alter table usr add constraint FK1C5947C6FEB32 foreign key (ca) references ca
alter table usr_attrs add constraint FKA39E0E37566C2A8F foreign key (a_id) references attributes
alter table usr_attrs add constraint FKA39E0E3720331206 foreign key (u_id) references usr
alter table vo_membership_req add constraint FK28EE8AFBD75D60A4 foreign key (request_id) references req
create sequence VOMS_ACL_SEQ
create sequence VOMS_ADMIN_SEQ
create sequence VOMS_ATTR_DESC_SEQ
create sequence VOMS_AUP_ACC_REC_SEQ
create sequence VOMS_AUP_SEQ
create sequence VOMS_AUP_VER_SEQ
create sequence VOMS_CA_SEQ
create sequence VOMS_CERT_SEQ
create sequence VOMS_GROUP_SEQ
create sequence VOMS_M_SEQ
create sequence VOMS_PI_SEQ
create sequence VOMS_PI_TYPE_SEQ
create sequence VOMS_REQ_INFO_SEQ
create sequence VOMS_REQ_SEQ
create sequence VOMS_ROLE_SEQ
create sequence VOMS_TAG_MAP_SEQ
create sequence VOMS_TAG_SEQ
create sequence VOMS_TASK_LR_SEQ
create sequence VOMS_TASK_SEQ
create sequence VOMS_TASK_TYPE_SEQ
create sequence hibernate_sequence
Deploying voms database...
Database deployed correctly!
Adding VO administrator reading information from /etc/grid-security/vomscert.pem
Admin '/C=IT/O=IGI/CN=superchunk.cnaf.infn.it,/C=IT/O=IGI/CN=Test CA' not found. It will be created...
Adding ALL permissions on '/emi3' for admin '/C=IT/O=IGI/CN=superchunk.cnaf.infn.it,/C=IT/O=IGI/CN=Test CA'
Adding ALL permissions on role '/emi3/Role=VO-Admin' for admin '/C=IT/O=IGI/CN=superchunk.cnaf.infn.it,/C=IT/O=IGI/CN=Test CA'
WARNING: No email was specified for this administrator! The new administrator will not receive VOMS Admin notifications
Adding read-only access to authenticated clients on the VO.
Checking that the database is writable...
Database is writable.
Granting read-only access to any authenticated user on group '/emi3'
Granting read-only access to any authenticated user on role '/emi3/Role=VO-Admin'
Configuring VOMS core service for vo emi3
VOMS core service configured succesfully.
VO emi3 configuration completed succesfully.
[root@superchunk.cnaf.infn.it ~]# echo >> /etc/sysconfig/voms; echo 'TNS_ADMIN=/etc/voms' >> /etc/sysconfig/voms
[root@superchunk.cnaf.infn.it ~]# sed -i -e "s#localhost#superchunk.cnaf.infn.it#g" /etc/voms-admin/voms-admin-server.properties
[root@superchunk.cnaf.infn.it ~]# yum -y install ca_INFN-CA-2006
Loaded plugins: kernel-module, priorities, protectbase
Repository EGI-trustanchors is listed more than once in the configuration
4469 packages excluded due to repository priority protections
0 packages excluded due to repository protections
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package ca_INFN-CA-2006.noarch 0:1.52-1 set to be updated
--> Finished Dependency Resolution
Beginning Kernel Module Plugin
Finished Kernel Module Plugin

Dependencies Resolved

================================================================================
 Package               Arch         Version        Repository              Size
================================================================================
Installing:
 ca_INFN-CA-2006       noarch       1.52-1         EGI-trustanchors       5.2 k

Transaction Summary
================================================================================
Install       1 Package(s)
Upgrade       0 Package(s)

Total download size: 5.2 k
Downloading Packages:
warning: rpmts_HdrFromFdno: Header V3 DSA signature: NOKEY, key ID 3cdbbc71
Importing GPG key 0x3CDBBC71 "EUGridPMA Distribution Signing Key 3 <info@eugridpma.org>" from http://repository.egi.eu/sw/production/cas/1/GPG-KEY-EUGridPMA-RPM-3
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : ca_INFN-CA-2006                                          1/1 

Installed:
  ca_INFN-CA-2006.noarch 0:1.52-1                                               

Complete!
[root@superchunk.cnaf.infn.it ~]# voms-config-info-providers -s local -e
Will install providers for voms-admin
Creating conf file /etc/glite/info/service/glite-info-glue2-voms.conf
Creating conf file /etc/glite/info/service/glite-info-service-voms.conf
Creating conf file /etc/glite/info/service/glite-info-glue2-voms-admin.conf
Creating conf file /etc/glite/info/service/glite-info-service-voms-admin.conf
Create the /var/lib/bdii/gip/provider in case it doesn't exist
Create the /var/lib/bdii/gip/provider/glite-info-glue2-provider-service-voms file
Create the /var/lib/bdii/gip/provider/glite-info-provider-service-voms file
Create the /var/lib/bdii/gip/provider/glite-info-provider-service-voms-admin file
Reconfiguring BDII...
[root@superchunk.cnaf.infn.it ~]# cat /etc/sysconfig/bdii
#SLAPD_CONF=/etc/bdii/bdii-slapd.conf
SLAPD=/usr/sbin/slapd2.4
#BDII_RAM_DISK=no
[root@superchunk.cnaf.infn.it ~]# service bdii start
Starting BDII slapd: [60G[[0;32m  OK  [0;39m]
Starting BDII update process: [60G[[0;32m  OK  [0;39m]
[root@superchunk.cnaf.infn.it ~]# fetch-crl -o /etc/grid-security/certificates -l /etc/grid-security/certificates
[root@superchunk.cnaf.infn.it ~]# service voms start
Starting voms(emi3): [60G[[0;32m  OK  [0;39m]
[root@superchunk.cnaf.infn.it ~]# service voms-admin start
Deploying vo(emi3): [60G[  [1;32mOK[0;39m  ]
Starting voms-admin: [60G[  [1;32mOK[0;39m  ]
[root@superchunk.cnaf.infn.it ~]# sleep 30
[root@superchunk.cnaf.infn.it ~]# voms-admin --vo emi3 list-groups
 /emi3
[root@superchunk.cnaf.infn.it ~]# wget --no-check-certificate https://raw.github.com/valerioventuri/voms-deployment-test/master/populate-vo.sh
--2013-04-04 16:38:51--  https://raw.github.com/valerioventuri/voms-deployment-test/master/populate-vo.sh
Resolving raw.github.com... 199.27.76.133
Connecting to raw.github.com|199.27.76.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1186 (1.2K) [text/plain]
Saving to: `populate-vo.sh'

     0K .                                                     100% 19.8M=0s

2013-04-04 16:38:52 (19.8 MB/s) - `populate-vo.sh' saved [1186/1186]

[root@superchunk.cnaf.infn.it ~]# sh populate-vo.sh emi3
[root@superchunk.cnaf.infn.it ~]# yum -y install voms-clients3
Loaded plugins: kernel-module, priorities, protectbase
Repository EGI-trustanchors is listed more than once in the configuration
4469 packages excluded due to repository priority protections
0 packages excluded due to repository protections
Setting up Install Process
Resolving Dependencies
--> Running transaction check
---> Package voms-clients3.noarch 0:3.0.0-1.sl5 set to be updated
--> Processing Dependency: voms-api-java3 for package: voms-clients3
--> Processing Dependency: jakarta-commons-io for package: voms-clients3
--> Running transaction check
---> Package jakarta-commons-io.noarch 0:1.4-3.el5 set to be updated
---> Package voms-api-java3.noarch 0:3.0.0-1.sl5 set to be updated
--> Processing Dependency: bouncycastle146-mail for package: voms-api-java3
--> Processing Dependency: canl-java for package: voms-api-java3
--> Running transaction check
---> Package bouncycastle146-mail.noarch 0:1.46-1 set to be updated
--> Processing Dependency: bouncycastle146 = 1.46 for package: bouncycastle146-mail
---> Package canl-java.noarch 0:1.1.0-2.sl5 set to be updated
--> Running transaction check
---> Package bouncycastle146.noarch 0:1.46-1.el5 set to be updated
--> Finished Dependency Resolution
Beginning Kernel Module Plugin
Finished Kernel Module Plugin

Dependencies Resolved

================================================================================
 Package                   Arch        Version            Repository       Size
================================================================================
Installing:
 voms-clients3             noarch      3.0.0-1.sl5        VOMS            124 k
Installing for dependencies:
 bouncycastle146           noarch      1.46-1.el5         EMI-3-base      1.9 M
 bouncycastle146-mail      noarch      1.46-1             VOMS            475 k
 canl-java                 noarch      1.1.0-2.sl5        EMI-3-base      263 k
 jakarta-commons-io        noarch      1.4-3.el5          epel            105 k
 voms-api-java3            noarch      3.0.0-1.sl5        VOMS            120 k

Transaction Summary
================================================================================
Install       6 Package(s)
Upgrade       0 Package(s)

Total download size: 2.9 M
Downloading Packages:
--------------------------------------------------------------------------------
Total                                           2.5 MB/s | 2.9 MB     00:01     
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : bouncycastle146                                          1/6 
  Installing     : jakarta-commons-io                                       2/6 
  Installing     : canl-java                                                3/6 
  Installing     : bouncycastle146-mail                                     4/6 
  Installing     : voms-api-java3                                           5/6 
  Installing     : voms-clients3                                            6/6 

Installed:
  voms-clients3.noarch 0:3.0.0-1.sl5                                            

Dependency Installed:
  bouncycastle146.noarch 0:1.46-1.el5   bouncycastle146-mail.noarch 0:1.46-1   
  canl-java.noarch 0:1.1.0-2.sl5        jakarta-commons-io.noarch 0:1.4-3.el5  
  voms-api-java3.noarch 0:3.0.0-1.sl5  

Complete!
[root@superchunk.cnaf.infn.it ~]# mkdir -p .globus
[root@superchunk.cnaf.infn.it ~]# cp /usr/share/igi-test-ca/test0.cert.pem .globus/usercert.pem
[root@superchunk.cnaf.infn.it ~]# cp /usr/share/igi-test-ca/test0.key.pem .globus/userkey.pem
[root@superchunk.cnaf.infn.it ~]# chmod 600 .globus/usercert.pem
[root@superchunk.cnaf.infn.it ~]# chmod 400 .globus/userkey.pem
[root@superchunk.cnaf.infn.it ~]# mkdir /etc/vomses
[root@superchunk.cnaf.infn.it ~]# cp /etc/voms-admin/emi3/vomses /etc/vomses/emi3
[root@superchunk.cnaf.infn.it ~]# mkdir /etc/grid-security/vomsdir/emi3
[root@superchunk.cnaf.infn.it ~]# cp /etc/voms-admin/emi3/lsc /etc/grid-security/vomsdir/emi3/superchunk.cnaf.infn.it.lsc
[root@superchunk.cnaf.infn.it ~]# echo 'pass' | voms-proxy-init -voms emi3 --pwstdin
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.


Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:14 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:13 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:12 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:11 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:10 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:09 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:08 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:07 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:06 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:05 CEST 2013
[root@superchunk.cnaf.infn.it ~]# voms-proxy-init -voms emi3 -noregen
Contacting superchunk.cnaf.infn.it:15000 [/C=IT/O=IGI/CN=superchunk.cnaf.infn.it] "emi3"...
Remote VOMS server contacted succesfully.

WARNING: proxy lifetime limited to issuing credential lifetime.

Created proxy in /tmp/x509up_u0.

Your proxy is valid until Fri Apr 05 04:39:04 CEST 2013
VOMS succesfully deployed!
